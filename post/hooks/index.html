<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>hooks | Gaviota</title>
<link rel="stylesheet" href="https://pastSeagull.github.io/blog//css/style.css">



<link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/monokai.min.css" rel="stylesheet">





<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://pastSeagull.github.io/blog/"><h1 class="title is-4">Gaviota</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="https://github.com/pastSeagull">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://twitter.com/pastSeagull">
            <span class="icon">
              <i class="fa fa-twitter"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="subtitle is-6">March 16, 2022</h2>
    <h1 class="title">hooks</h1>
    <div class="content">
      <p>hooks的一些基本用法</p>
<h1 id="api">api</h1>
<ul>
<li>useCallback</li>
<li>useContext</li>
<li>useEffect</li>
<li>useLayoutEffect</li>
<li>useMemo</li>
<li>useReducer</li>
<li>useRef</li>
<li>useState</li>
</ul>
<h2 id="usestate">useState</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 定义count的初始状态，如果是function的话就用返回值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">setCount</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#ae81ff">0</span>)
<span style="color:#75715e">// or
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">setCount</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(() =&gt; <span style="color:#ae81ff">0</span>)
<span style="color:#75715e">// 还有就是不能在Component函数中同步调用setCount
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">App</span> <span style="color:#f92672">=</span> () =&gt; {
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">setCount</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#ae81ff">0</span>)
    <span style="color:#75715e">// 在同步中调用setCount
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Too many re-renders. React limits the number of renders to prevent an infinite loop.
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">setCount</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) 

    <span style="color:#66d9ef">return</span>(
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
        {<span style="color:#a6e22e">count</span>}
        <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{() =&gt; { 
           <span style="color:#a6e22e">setCount</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)

           <span style="color:#75715e">// 这里会不会即时改变
</span><span style="color:#75715e"></span>           <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">count</span>)
          }}
          <span style="color:#f92672">&gt;+&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
    )
}
</code></pre></div><p>如果初始值是<code>function</code>的话，<code>useState</code>的值只会在初始化的时候执行</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 这边props点击+1，但是子组件的count还是没有改变
</span><span style="color:#75715e">// 当然可以利用这个特点，组件重绘的时候就不用在进行useState的计算了
</span><span style="color:#75715e">// setCount传函数，传函数的好处就是依赖自身的状态来更新，不依赖外部变量
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// 子组件
</span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Button</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">props</span>) =&gt; {
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">count</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(() =&gt; <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">data</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span>)
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">data</span>} <span style="color:#a6e22e">count</span><span style="color:#f92672">:</span>{<span style="color:#a6e22e">count</span>}<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
}
<span style="color:#75715e">// 父组件
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">App</span> <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">setData</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#ae81ff">1</span>)
    <span style="color:#66d9ef">return</span>(
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{() =&gt; <span style="color:#a6e22e">setData</span>(<span style="color:#a6e22e">data</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)}<span style="color:#f92672">&gt;</span><span style="color:#a6e22e">data</span><span style="color:#f92672">:</span>{<span style="color:#a6e22e">data</span>}<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
        <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Button</span> <span style="color:#a6e22e">data</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">data</span>} <span style="color:#f92672">/&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
    )
}
</code></pre></div><h2 id="useref">useRef</h2>
<blockquote>
<p>存放数据，无论在哪里都能取到最新的状态，就需要使用useRef</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">setCount</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#ae81ff">0</span>)

<span style="color:#a6e22e">useEffect</span>(() =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">setInterval</span>(() =&gt; {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">count</span>) <span style="color:#75715e">// 一直打印 0
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">setCount</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
    }, <span style="color:#ae81ff">1000</span>)
    <span style="color:#66d9ef">return</span> () =&gt; <span style="color:#a6e22e">clearInterval</span>(<span style="color:#a6e22e">id</span>)
}, [])
<span style="color:#75715e">// 改成useRef
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">setCount</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#ae81ff">0</span>)

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">countRef</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useRef</span>(<span style="color:#a6e22e">count</span>)
<span style="color:#a6e22e">countRef</span>.<span style="color:#a6e22e">current</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">count</span>

<span style="color:#a6e22e">useEffect</span>(() =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">setInterval</span>(() =&gt; {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">countRef</span>.<span style="color:#a6e22e">current</span>)
        <span style="color:#a6e22e">setCount</span>( <span style="color:#a6e22e">countRef</span>.<span style="color:#a6e22e">current</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">countRef</span>.<span style="color:#a6e22e">current</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#75715e">// 0 1 2 3...
</span><span style="color:#75715e"></span>    })
    <span style="color:#66d9ef">return</span> () =&gt; <span style="color:#a6e22e">clearInterval</span>(<span style="color:#a6e22e">id</span>)
}, [])
</code></pre></div><blockquote>
<p>这边注意，修改useRef的值并不会引起react的重新渲染
useRef的值改变并不会造成页面重新渲染，这一点可以做很多事情。比如可以配合useEffect查询页面是首次渲染还是更新。</p>
</blockquote>
<p>使用<code>useRef</code>获取dom</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">App</span> <span style="color:#f92672">=</span> () =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">domRef</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useRef</span>(<span style="color:#66d9ef">null</span>)

    <span style="color:#a6e22e">useEffect</span>(() =&gt; {
      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">domRef</span>)
    })

    <span style="color:#66d9ef">return</span>(
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span> <span style="color:#a6e22e">ref</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">domRef</span>} <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span><span style="color:#f92672">&gt;&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
    )
}
</code></pre></div><h2 id="useeffect">useEffect</h2>
<blockquote>
<p>每次渲染生效之后执行
函数组件中，当组件完成挂载，这时候可以请求数据，可以使用useEffect
可以当成是class组件中的<code>componentDidMount</code>, <code>componentDidUpdate</code>, <code>componentWillUnmount </code>
的组合</p>
</blockquote>
<p><code>useEffect</code>第二个参数，当数组内的依赖发生变化时，则重新执行<code>useEffect</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">setCount</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#ae81ff">0</span>)

<span style="color:#a6e22e">useEffect</span>(() =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">count</span>)
    <span style="color:#75715e">// 当这里操作使用到了别的，eslint会提示你把它加入第二个参数，但是你实际上并不需要依赖它
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 可以加上注释去忽视eslint的提示
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// eslint-disable-next-line react-hooks/exhaustive-deps
</span><span style="color:#75715e"></span>}, [])

<span style="color:#75715e">// useEffect第二个参数，当数组内的依赖发生变化时，则重新执行useEffect
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">setCount</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#ae81ff">0</span>)

<span style="color:#a6e22e">useEffect</span>(() =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">count</span>)
}, [<span style="color:#a6e22e">count</span>])

<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{() =&gt; <span style="color:#a6e22e">setCount</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)}<span style="color:#f92672">&gt;+</span>{<span style="color:#a6e22e">count</span>}<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>

<span style="color:#75715e">// 如果需要在组件销毁的阶段，做一些操作，需要在useEffect结尾返回一个函数
</span><span style="color:#75715e">// 相当于 componentWillUnmount
</span><span style="color:#75715e"></span><span style="color:#a6e22e">useEffect</span>(() =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">count</span>)

    <span style="color:#a6e22e">retrun</span> () =&gt; <span style="color:#a6e22e">clearInterval</span>(<span style="color:#a6e22e">timer</span>)
}, [<span style="color:#a6e22e">count</span>])
</code></pre></div><ul>
<li>async</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">useEffect</span>(<span style="color:#66d9ef">async</span> () =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">get</span>()
}, [])
<span style="color:#75715e">// 在外面包装一层
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getSomething</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">callback</span>) =&gt; {
    <span style="color:#a6e22e">useEffect</span>(() =&gt; {
        <span style="color:#a6e22e">callback</span>()
    }, [])
}
</code></pre></div><h2 id="uselayouteffect">useLayoutEffect</h2>
<p>和<code>useEffect</code>传参一样，不过有以下区别</p>
<blockquote>
<p>执行的时机不同，useLayoutEffect会在react更新DOM树后同步调用
在development模式下SSR会有警告
一般情况下回用在做动效和记录layout的一些特殊场景，一般不会使用</p>
</blockquote>
<h2 id="usecontext">useContext</h2>
<p>来获取父组件传递的context值，父组件设置Provider设置的value值
两种方式来获取context的值</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Context</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">createContext</span>()

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">App</span> <span style="color:#f92672">=</span> () =&gt; {
    <span style="color:#66d9ef">return</span>(
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
          <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Context</span>.<span style="color:#a6e22e">Provider</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#ae81ff">123</span>}<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Countext1</span> <span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Countext2</span> <span style="color:#f92672">/&gt;</span>
          <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/Context.Provider&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
    )
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Countext1</span> <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useContext</span>(<span style="color:#a6e22e">Context</span>)
  <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Countext1</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">value</span> }<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Countext2</span> <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Context</span>.<span style="color:#a6e22e">Consumer</span><span style="color:#f92672">&gt;</span>
      {(<span style="color:#a6e22e">value</span>) =&gt; <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Countext2</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">value</span> }<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;}</span>
  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/Context.Consumer&gt;</span>
}
</code></pre></div><h2 id="usereducer">useReducer</h2>
<p>类似redux的api。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 简单使用
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">App</span> <span style="color:#f92672">=</span> () =&gt; {
    <span style="color:#66d9ef">const</span>[<span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">despatchCount</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useReducer</span>((<span style="color:#a6e22e">state</span>, <span style="color:#a6e22e">action</span>) =&gt; {
      <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">payload</span>, <span style="color:#a6e22e">type</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">action</span>
      
      <span style="color:#66d9ef">switch</span>(<span style="color:#a6e22e">type</span>){
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;add&#39;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;sub&#39;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> 
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;reset&#39;</span><span style="color:#f92672">:</span>
          <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">payload</span>       
      }
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span>
    }, <span style="color:#ae81ff">0</span>)

    <span style="color:#66d9ef">return</span>(
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
          { <span style="color:#a6e22e">count</span> }
          <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{() =&gt;<span style="color:#a6e22e">despatchCount</span>({ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;add&#39;</span>})}<span style="color:#f92672">&gt;</span><span style="color:#a6e22e">add</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
          <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{() =&gt;<span style="color:#a6e22e">despatchCount</span>({ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;sub&#39;</span>})}<span style="color:#f92672">&gt;</span><span style="color:#a6e22e">sub</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
          <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{() =&gt;<span style="color:#a6e22e">despatchCount</span>({ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;reset&#39;</span>, <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">123</span>})}<span style="color:#f92672">&gt;</span><span style="color:#a6e22e">reset</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
          {<span style="color:#75715e">/* 传给子组件 */</span>}
          <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Children</span> <span style="color:#a6e22e">dispatch</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">despatchCount</span>} <span style="color:#a6e22e">State</span><span style="color:#f92672">=</span>{{ <span style="color:#a6e22e">count</span> }} <span style="color:#f92672">/&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
    )
}
</code></pre></div><h2 id="usememo">useMemo</h2>
<p>它会保留上一次的计算，看结果是否变更，是否来使用上次的计算</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 这里点击增加count 子组件也会重新render
</span><span style="color:#75715e">// 虽然子组件并不依赖于父组件的count
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Child</span> <span style="color:#f92672">=</span> ({<span style="color:#a6e22e">data</span>}) =&gt; {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;child render&#39;</span>, <span style="color:#a6e22e">data</span>)
  <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>{<span style="color:#a6e22e">data</span>}<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">App</span> <span style="color:#f92672">=</span> () =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;father render&#39;</span>)
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">setCount</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#ae81ff">0</span>)
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">setData</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#e6db74">&#39;seagull&#39;</span>)

    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useMemo</span>(() =&gt; {
        <span style="color:#66d9ef">return</span> {
            <span style="color:#a6e22e">data</span>
        }
    }, [<span style="color:#a6e22e">data</span>])

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
      {<span style="color:#a6e22e">count</span>} 

      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{() =&gt; <span style="color:#a6e22e">setCount</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)}<span style="color:#f92672">&gt;</span><span style="color:#a6e22e">count</span><span style="color:#f92672">+&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Child</span> <span style="color:#a6e22e">data</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">name</span>} <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
}
<span style="color:#75715e">// 改成这样
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Child</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">memo</span>(({<span style="color:#a6e22e">data</span>}) =&gt; {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;child render&#39;</span>, <span style="color:#a6e22e">data</span>)
  <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">child</span><span style="color:#f92672">:</span> {<span style="color:#a6e22e">data</span>}<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
})

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">App</span> <span style="color:#f92672">=</span> () =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;father render&#39;</span>)
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">setCount</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#ae81ff">0</span>)
    <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">data</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#e6db74">&#39;seagull&#39;</span>)

    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useMemo</span>(() =&gt; {
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">data</span>
    }, [<span style="color:#a6e22e">data</span>])

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
      {<span style="color:#a6e22e">count</span>} 

      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{() =&gt; <span style="color:#a6e22e">setCount</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)}<span style="color:#f92672">&gt;</span><span style="color:#a6e22e">count</span><span style="color:#f92672">+&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Child</span> <span style="color:#a6e22e">data</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">name</span>} <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
}
</code></pre></div><h2 id="usecallback">useCallback</h2>
<p>简化版的<code>useMemo</code></p>
<p>其实也没有必要为了性能优化去使用useMemo、useCallback、Profiling、React.mome去优化性能。
基本上大多数情况下现有的算法能满足性能的需求了</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">callback</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useCallback</span>((...<span style="color:#a6e22e">args</span>) =&gt; {
    <span style="color:#75715e">// do something
</span><span style="color:#75715e"></span>}, [...<span style="color:#a6e22e">deps</span>])

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">memo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useMemo</span>((...<span style="color:#a6e22e">args</span>) =&gt; {
    <span style="color:#75715e">// do something
</span><span style="color:#75715e"></span>}, [...<span style="color:#a6e22e">deps</span>])
</code></pre></div>
    </div>
  </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/pastSeagull">Gaviota</a> 2016</p>
  </div>
</section>







<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>







<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>






