<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pinia | Gaviota</title>
<link rel="stylesheet" href="https://pastSeagull.github.io/blog//css/style.css">



<link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/monokai.min.css" rel="stylesheet">





<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://pastSeagull.github.io/blog/"><h1 class="title is-4">Gaviota</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="https://github.com/pastSeagull">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://twitter.com/pastSeagull">
            <span class="icon">
              <i class="fa fa-twitter"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="subtitle is-6">August 12, 2022</h2>
    <h1 class="title">Pinia</h1>
    <div class="content">
      <p>pinia一些笔记。</p>
<p>State、Getters、Action、plugins</p>
<h2 id="state">state</h2>
<p>一个简单的store</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">defineStore</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;pinia&#34;</span>;
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">catStore</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">defineStore</span>(<span style="color:#e6db74">&#34;cat&#34;</span>, {
    <span style="color:#a6e22e">state</span><span style="color:#f92672">:</span> () =&gt; {
        <span style="color:#66d9ef">return</span> {
            <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;yellow&#34;</span>,
            <span style="color:#a6e22e">weight</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10</span>
            <span style="color:#a6e22e">age</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
        }
    },
})

<span style="color:#75715e">// 使用
</span><span style="color:#75715e">// 直接使用ES6解构能得到值 但是丢失响应式，用storeToRefs
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">catStore</span>()
<span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">color</span>, <span style="color:#a6e22e">age</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">storeToRefs</span>(<span style="color:#a6e22e">cat</span>)

<span style="color:#75715e">// 改变store
</span><span style="color:#75715e"></span><span style="color:#a6e22e">cat</span>.<span style="color:#a6e22e">age</span><span style="color:#f92672">++</span>

<span style="color:#75715e">// 改变多条
</span><span style="color:#75715e"></span><span style="color:#a6e22e">catStore</span>.<span style="color:#a6e22e">$patch</span>({
    <span style="color:#a6e22e">age</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cat</span>.<span style="color:#a6e22e">age</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
    <span style="color:#a6e22e">weight</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cat</span>.<span style="color:#a6e22e">weight</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">10</span>
})

<span style="color:#75715e">// 重置状态
</span><span style="color:#75715e"></span><span style="color:#a6e22e">cat</span>.<span style="color:#a6e22e">$reset</span>()

<span style="color:#75715e">// 新增新对象？中文文档上说是设置新对象来替换store状态
</span><span style="color:#75715e">// You cannot exactly replace the state of a store as that would break reactivity. 
</span><span style="color:#75715e">// You can however patch it:
</span><span style="color:#75715e"></span><span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">$state</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">hobby</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sleep&#34;</span> }
</code></pre></div><h2 id="getters">Getters</h2>
<p>这个相当于vue的<code>computed</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">useStore</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">defineStore</span>(<span style="color:#e6db74">&#39;main&#39;</span>, {
  <span style="color:#a6e22e">state</span><span style="color:#f92672">:</span> () =&gt; ({
    <span style="color:#a6e22e">counter</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
  }),
  
  <span style="color:#a6e22e">getters</span><span style="color:#f92672">:</span> {
    <span style="color:#75715e">// 会自动推断类型
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">doubleCount</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">state</span>) =&gt; <span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">counter</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>,
    <span style="color:#75715e">// 用this 自己设置类型
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">doublePlusOne</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">number</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">counter</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
    },
  },
  
})
<span style="color:#75715e">// 直接使用Getters
</span><span style="color:#75715e"></span><span style="color:#a6e22e">useStore</span>.<span style="color:#a6e22e">doubleCount</span>

<span style="color:#75715e">// 访问其他getter
</span><span style="color:#75715e"></span><span style="color:#a6e22e">doubleCount</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">state</span>) =&gt; <span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">counter</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>,
<span style="color:#75715e">// return * 2 + 1
</span><span style="color:#75715e"></span><span style="color:#a6e22e">doublePlusOne</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">number</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">doubleCount</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
},

<span style="color:#75715e">// 可以通过返回一个函数去接收参数,但是这时候不会在进行缓存
</span><span style="color:#75715e"></span><span style="color:#a6e22e">getUserById</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">state</span>) =&gt; {
    <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">userId</span>) =&gt; <span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">find</span>((<span style="color:#a6e22e">user</span>) =&gt; <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">userId</span>)
},
<span style="color:#a6e22e">useStore</span>.<span style="color:#a6e22e">getUserById</span>(<span style="color:#ae81ff">1</span>)
<span style="color:#75715e">// 改成
</span><span style="color:#75715e"></span><span style="color:#a6e22e">getActiveUserById</span>(<span style="color:#a6e22e">state</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">activeUsers</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">user</span>) =&gt; <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">active</span>)
    <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">userId</span>) =&gt; <span style="color:#a6e22e">activeUsers</span>.<span style="color:#a6e22e">find</span>((<span style="color:#a6e22e">user</span>) =&gt; <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">userId</span>)
},
</code></pre></div><h2 id="actions">Actions</h2>
<p><code>actions</code>相当于<code>vuex</code>的<code>methods</code>，但是可以进行异步操作</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">actions</span><span style="color:#f92672">:</span> {
    <span style="color:#a6e22e">changeAge</span>() {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">age</span><span style="color:#f92672">++</span>
    }
    <span style="color:#66d9ef">async</span> <span style="color:#a6e22e">getUser</span>() {
        <span style="color:#66d9ef">try</span> {
            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">apiUser</span>()
        } <span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">error</span>) {}
    }
}
<span style="color:#75715e">// 使用
</span><span style="color:#75715e"></span><span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">getUser</span>()
</code></pre></div><h2 id="plugins">plugins</h2>
<p>插件可以做以下操作</p>
<ul>
<li>向 Store 添加新属性</li>
<li>定义 Store 时添加新选项</li>
<li>为 Store 添加新方法</li>
<li>包装现有方法</li>
<li>更改甚至取消操作</li>
<li>实现本地存储等副作用</li>
<li>仅适用于特定 Store</li>
</ul>
<p><code>pinia.use()</code>添加插件</p>
<p>为所有的<code>Store</code>添加静态属性</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">SecretPiniaPlugin</span>() {
    <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">secret</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;the cake is a lie&#39;</span> }
}
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pinia</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createPinia</span>()
<span style="color:#a6e22e">pinia</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">SecretPiniaPlugin</span>)
</code></pre></div><p>待续&hellip;</p>
    </div>
  </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/pastSeagull">Gaviota</a> 2016</p>
  </div>
</section>







<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>







<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>






