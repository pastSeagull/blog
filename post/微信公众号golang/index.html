<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>微信公众号&amp;golang | Gaviota</title>
<link rel="stylesheet" href="https://pastSeagull.github.io/blog//css/style.css">



<link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/monokai.min.css" rel="stylesheet">





<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://pastSeagull.github.io/blog/"><h1 class="title is-4">Gaviota</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="https://github.com/pastSeagull">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://twitter.com/pastSeagull">
            <span class="icon">
              <i class="fa fa-twitter"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="subtitle is-6">May 4, 2022</h2>
    <h1 class="title">微信公众号&amp;golang</h1>
    <div class="content">
      <p>本篇是关于如何拿到<code>wx.config</code>所需要的参数。</p>
<h2 id="测试号">测试号</h2>
<p>首先你要先去申请一个，拿到测试号的<code>appID</code> <code>appsecret</code>
<a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login">https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login</a></p>
<p>我们先看一下微信<code>jssdk</code>的<code>config</code>需要什么</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">config</span>({
    <span style="color:#a6e22e">debug</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#75715e">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">appId</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#75715e">// 必填，公众号的唯一标识
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">timestamp</span><span style="color:#f92672">:</span> , <span style="color:#75715e">// 必填，生成签名的时间戳
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">nonceStr</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#75715e">// 必填，生成签名的随机串
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">signature</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>,<span style="color:#75715e">// 必填，签名
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">jsApiList</span><span style="color:#f92672">:</span> [] <span style="color:#75715e">// 必填，需要使用的JS接口列表
</span><span style="color:#75715e"></span>});
</code></pre></div><h3 id="signature">signature</h3>
<p>1、通过测试号的<code>appId</code>和<code>appsecret</code>我们先获取<code>access_token</code>，通过下面接口获取。</p>
<blockquote>
<p><a href="https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=$%7Bappid%7D&amp;secret=$%7Bsecret%7D">https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=${appid}&amp;secret=${secret}</a></p>
</blockquote>
<p>2、拿到<code>access_token</code>后在使用<code>access_token</code>去获取<code>jsapi_ticket</code>，有效期只有7200秒，我们需要缓存<code>jsapi_ticket</code>。</p>
<blockquote>
<p><a href="https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=ACCESS_TOKEN&amp;type=jsapi">https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=ACCESS_TOKEN&amp;type=jsapi</a></p>
</blockquote>
<p>我们拿到<code>jsapi_ticket</code>后就可以生成<code>jssdk</code>的签名了。</p>
<p>看一下代码</p>
<p>拿到<code>access_token</code>和<code>jsapi_ticket</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetWeixin</span>(<span style="color:#a6e22e">appid</span>, <span style="color:#a6e22e">secret</span> <span style="color:#66d9ef">string</span>) {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">tk</span> <span style="color:#a6e22e">Token</span>
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">tc</span> <span style="color:#a6e22e">Ticket</span>
	<span style="color:#a6e22e">db</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storm</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#e6db74">&#34;db/weixin.db&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Database open err:&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Close</span>()

	<span style="color:#a6e22e">gorequest</span>.<span style="color:#a6e22e">New</span>().<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">appid</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;secret=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">secret</span>).<span style="color:#a6e22e">EndStruct</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tk</span>)
	<span style="color:#a6e22e">gorequest</span>.<span style="color:#a6e22e">New</span>().<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">tk</span>.<span style="color:#a6e22e">AccessToken</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;type=jsapi&#34;</span>).<span style="color:#a6e22e">EndStruct</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tc</span>)

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;sessions&#34;</span>, <span style="color:#e6db74">&#34;token&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tk</span>); <span style="color:#a6e22e">e</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;sessions&#34;</span>, <span style="color:#e6db74">&#34;ticket&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tc</span>); <span style="color:#a6e22e">e</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">Error</span>())
	}
}
</code></pre></div><h4 id="签名算法">签名算法</h4>
<blockquote>
<p>签名生成规则如下：参与签名的字段包括noncestr（随机字符串）, 有效的jsapi_ticket, timestamp（时间戳）, 
url（当前网页的URL，不包含#及其后面部分） 。对所有待签名参数按照字段名的ASCII 码从小到大排序（字典序）后，
使用URL键值对的格式（即key1=value1&amp;key2=value2…）拼接成字符串string1。这里需要注意的是所有参数名均为小写字符。
对string1作sha1加密，字段名和字段值都采用原始值，不进行URL 转义。</p>
</blockquote>
<p>具体看官方文档
<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#62">https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#62</a></p>
<p>生成随机字符串</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">letterRunes</span> <span style="color:#f92672">:=</span> []rune(<span style="color:#e6db74">&#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span>)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">RandStringRunes</span>(<span style="color:#a6e22e">n</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">string</span> {
	<span style="color:#a6e22e">b</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">rune</span>, <span style="color:#a6e22e">n</span>)
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">b</span> {
		<span style="color:#a6e22e">b</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">letterRunes</span>[<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(len(<span style="color:#a6e22e">letterRunes</span>))]
	}
	<span style="color:#66d9ef">return</span> string(<span style="color:#a6e22e">b</span>)
}
</code></pre></div><p>微信签名算法并缓存</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetCanshu</span>(<span style="color:#a6e22e">noncestr</span>, <span style="color:#a6e22e">url</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">timestamp</span>, <span style="color:#a6e22e">signature</span> <span style="color:#66d9ef">string</span>) {
	<span style="color:#a6e22e">db</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storm</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#e6db74">&#34;db/weixin.db&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Database open err:&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Close</span>()

	<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() { <span style="color:#75715e">//异常处理
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> recover(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>(<span style="color:#ae81ff">3</span>) <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
		}
	}()
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">tc</span> <span style="color:#a6e22e">Ticket</span>
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;sessions&#34;</span>, <span style="color:#e6db74">&#34;ticket&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tc</span>); <span style="color:#a6e22e">e</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">Error</span>())
	}

	<span style="color:#a6e22e">timestamp</span> = <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">FormatInt</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Unix</span>(), <span style="color:#ae81ff">10</span>)
	<span style="color:#a6e22e">longstr</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;jsapi_ticket=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">tc</span>.<span style="color:#a6e22e">Ticket</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;noncestr=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">noncestr</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;timestamp=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">timestamp</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;url=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">url</span>

	<span style="color:#a6e22e">h</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sha1</span>.<span style="color:#a6e22e">New</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">e</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">longstr</span>)); <span style="color:#a6e22e">e</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">Error</span>())
	}

	<span style="color:#a6e22e">signature</span> = <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Sum</span>(<span style="color:#66d9ef">nil</span>))
	<span style="color:#66d9ef">return</span>
}
</code></pre></div><p>生成签名</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">signHandler</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">ParseForm</span>()
	<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Header</span>().<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Access-Control-Allow-Origin&#34;</span>, <span style="color:#e6db74">&#34;*&#34;</span>) <span style="color:#75715e">//允许访问所有域
</span><span style="color:#75715e"></span>
	<span style="color:#a6e22e">wxNoncestr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">RandStringRunes</span>(<span style="color:#ae81ff">32</span>)
	<span style="color:#a6e22e">wxURL</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">QueryUnescape</span>(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">FormValue</span>(<span style="color:#e6db74">&#34;url&#34;</span>))
	<span style="color:#a6e22e">timestamp</span>, <span style="color:#a6e22e">signature</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">GetCanshu</span>(<span style="color:#a6e22e">wxNoncestr</span>, <span style="color:#a6e22e">wxURL</span>)
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">u</span> = <span style="color:#a6e22e">Sign</span>{
		<span style="color:#a6e22e">AppID</span>:     <span style="color:#a6e22e">wxAppID</span>,
		<span style="color:#a6e22e">Timestamp</span>: <span style="color:#a6e22e">timestamp</span>,
		<span style="color:#a6e22e">NonceStr</span>:  <span style="color:#a6e22e">wxNoncestr</span>,
		<span style="color:#a6e22e">Signature</span>: <span style="color:#a6e22e">signature</span>,
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;get sign&#34;</span>, <span style="color:#a6e22e">u</span>)
	<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Header</span>().<span style="color:#a6e22e">Add</span>(<span style="color:#e6db74">&#34;Access-Control-Allow-Headers&#34;</span>, <span style="color:#e6db74">&#34;Content-Type&#34;</span>) <span style="color:#75715e">//header的类型
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Header</span>().<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Content-type&#34;</span>, <span style="color:#e6db74">&#34;application/json&#34;</span>)             <span style="color:#75715e">//返回数据格式是json
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">u</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
	}
	<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Write</span>(<span style="color:#a6e22e">b</span>)
}
</code></pre></div><p>最后接口给前端即可。</p>
<blockquote>
<p>http.HandleFunc(&quot;/sign&quot;, signHandler)</p>
</blockquote>
<p>完整代码</p>
<blockquote>
<p><a href="https://github.com/pastSeagull/Learn-demo/tree/main/wx">https://github.com/pastSeagull/Learn-demo/tree/main/wx</a></p>
</blockquote>
<h2 id="前端">前端</h2>
<p>通过接口获取<code>wx.config</code>需要的参数。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">App</span> <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">scanQRCode</span> <span style="color:#f92672">=</span> () =&gt; {
    <span style="color:#a6e22e">sign</span>().<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">res</span> =&gt; {

      <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">config</span>({
        <span style="color:#a6e22e">debug</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
        <span style="color:#a6e22e">appId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">app_id</span>,
        <span style="color:#a6e22e">timestamp</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">timestamp</span>,
        <span style="color:#a6e22e">nonceStr</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">nonce_str</span>,
        <span style="color:#a6e22e">signature</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">signature</span>,
        <span style="color:#a6e22e">jsApiList</span><span style="color:#f92672">:</span> [
          <span style="color:#e6db74">&#39;scanQRCode&#39;</span>
        ]
      })
      <span style="color:#75715e">// 成功or失败回调
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">ready</span>(() =&gt; {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;ok&#34;</span>)

        <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">scanQRCode</span>({
          <span style="color:#a6e22e">needResult</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e">// 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
</span><span style="color:#75715e"></span>          <span style="color:#a6e22e">scanType</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;qrCode&#34;</span>,<span style="color:#e6db74">&#34;barCode&#34;</span>], <span style="color:#75715e">// 可以指定扫二维码还是一维码，默认二者都有
</span><span style="color:#75715e"></span>          <span style="color:#a6e22e">success</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">res</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">any</span>) {
            <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">resultStr</span>; <span style="color:#75715e">// 当needResult 为 1 时，扫码返回的结果
</span><span style="color:#75715e"></span>          }
        });

      })
      <span style="color:#a6e22e">wx</span>.<span style="color:#a6e22e">error</span>((<span style="color:#a6e22e">err</span><span style="color:#f92672">:</span> Error) =&gt; {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">err</span>)
      })
    })
  }

  <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">scanQRCode</span>}<span style="color:#f92672">&gt;</span><span style="color:#a6e22e">扫一扫</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
}
</code></pre></div><h2 id="参考">参考</h2>
<hr>
<ol>
<li><a href="https://juejin.cn/post/6989882775994269726">微信测试号接入微信sdk本地开发调试</a></li>
<li><a href="https://github.com/henson/wxtoken">https://github.com/henson/wxtoken</a></li>
</ol>
    </div>
  </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/pastSeagull">Gaviota</a> 2016</p>
  </div>
</section>







<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>







<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>






