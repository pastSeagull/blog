<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Setup语法糖和一些生态库 | Gaviota</title>
<link rel="stylesheet" href="https://pastSeagull.github.io/blog//css/style.css">



<link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/monokai.min.css" rel="stylesheet">





<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://pastSeagull.github.io/blog/"><h1 class="title is-4">Gaviota</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="https://github.com/pastSeagull">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://twitter.com/pastSeagull">
            <span class="icon">
              <i class="fa fa-twitter"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="subtitle is-6">April 15, 2022</h2>
    <h1 class="title">Setup语法糖和一些生态库</h1>
    <div class="content">
      <p>前面我们了解到了vue3新增的一些东西，这里我们来看一下<code>setup</code>的语法糖。
并不完整哈，这里知识记录一些很简单的一些使用。</p>
<p>代码片段的demo是用<code>vite</code>创建的<code>yarn create vite package-name</code>。</p>
<p>把<code>script</code>改成<code>&lt;script setup lang=&quot;ts&quot;&gt;</code>，就可以使用语法糖了。
写法上个人感觉上和React有些类似。</p>
<p>话说以前都是<code>template</code>在上面
首先是组件，导入进来直接使用。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span> <span style="color:#a6e22e">setup</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ts&#34;</span><span style="color:#f92672">&gt;</span>
  <span style="color:#66d9ef">import</span> <span style="color:#a6e22e">HelloWorld</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./components/HelloWorld.vue&#39;</span>
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>

<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">template</span><span style="color:#f92672">&gt;</span>
  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">HelloWorld</span> <span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/template&gt;</span>
</code></pre></div><p>然后就是变量和方法都不需要在<code>return</code>出来了。</p>
<h2 id="defineprops--defineemits--defineexpose">defineProps &amp; defineEmits &amp; defineExpose</h2>
<p>看名字应该都知道是啥了
一个简单的栗子</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span> <span style="color:#a6e22e">setup</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ts&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">import</span> {<span style="color:#a6e22e">onMounted</span>, <span style="color:#a6e22e">ref</span>} <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;vue&#39;</span>
<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">HelloWorld</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./components/HelloWorld.vue&#39;</span>

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">emitTest</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">number</span>) =&gt; {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;子组件传的值&#39;</span>, <span style="color:#a6e22e">data</span>)
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">son</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ref</span>()
<span style="color:#a6e22e">onMounted</span>(() =&gt; {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">son</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">name</span>)
})
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>

<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">template</span><span style="color:#f92672">&gt;</span>
  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">HelloWorld</span> <span style="color:#a6e22e">ref</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;son&#34;</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">emitTest</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;emitTest&#34;</span> <span style="color:#a6e22e">msg</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hello world&#34;</span> <span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/template&gt;</span>
<span style="color:#75715e">// 子组件
</span><span style="color:#75715e"></span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span> <span style="color:#a6e22e">setup</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ts&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ref</span>, <span style="color:#a6e22e">defineEmits</span>, <span style="color:#a6e22e">defineExpose</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;vue&#39;</span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ref</span>(<span style="color:#ae81ff">0</span>)
<span style="color:#a6e22e">defineProps</span>({
  <span style="color:#a6e22e">msg</span><span style="color:#f92672">:</span> {
    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> String,
    <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>
  }
})
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">em</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">defineEmits</span>([<span style="color:#e6db74">&#39;emitTest&#39;</span>])
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">emCount</span> <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#a6e22e">em</span>(<span style="color:#e6db74">&#34;emitTest&#34;</span>, <span style="color:#ae81ff">17</span>)
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ref</span>(<span style="color:#e6db74">&#34;seagull&#34;</span>)
<span style="color:#a6e22e">defineExpose</span>({
  <span style="color:#a6e22e">name</span>
})
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>

<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">template</span><span style="color:#f92672">&gt;</span>
  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>{{<span style="color:#a6e22e">msg</span>}}<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;emCount&#34;</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">传值给父组件</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/template&gt;</span>
</code></pre></div><p>然后<code>defineProps</code>有这几种用法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">defineProps</span>([<span style="color:#e6db74">&#34;msg&#34;</span>]);
<span style="color:#a6e22e">defineProps</span>({
    <span style="color:#a6e22e">msg</span><span style="color:#f92672">:</span> String
});
<span style="color:#a6e22e">defineProps</span>({
    <span style="color:#a6e22e">msg</span><span style="color:#f92672">:</span>{
        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> String,
        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>
    }
});
<span style="color:#a6e22e">defineProps</span><span style="color:#f92672">:</span>{
    <span style="color:#a6e22e">msg</span><span style="color:#f92672">:</span>[String, Number]
}
</code></pre></div><p>然后有个有个包<code>vue-global-api</code>，这样直接使用<code>api</code>了。
<a href="https://github.com/antfu/vue-global-api">https://github.com/antfu/vue-global-api</a></p>
<h2 id="vue-router4">vue-router@4</h2>
<p>首先是<code>new Router()</code>变成了<code>createRouter()</code>，还有就是用<code>history</code>代替了<code>mode</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">createRouter</span>, <span style="color:#a6e22e">createWebHistory</span>, <span style="color:#a6e22e">RouteRecordRaw</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;vue-router&#39;</span>

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">routes</span><span style="color:#f92672">:</span> Array<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">RouteRecordRaw</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> [
    {
        <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;/page1&#39;</span>,
        <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Page1&#39;</span>,
        <span style="color:#a6e22e">component</span><span style="color:#f92672">:</span> () =&gt; <span style="color:#66d9ef">import</span>(<span style="color:#e6db74">&#39;../components/page1.vue&#39;</span>)
    }
]
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">router</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createRouter</span>({
    <span style="color:#a6e22e">history</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">createWebHistory</span>(),
    <span style="color:#a6e22e">routes</span>
})

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">router</span>;
</code></pre></div><p>具体变化可以看一下官方文档或者下面链接</p>
<p><a href="https://juejin.cn/post/7049974026650779661#heading-15">https://juejin.cn/post/7049974026650779661#heading-15</a></p>
<p><a href="https://juejin.cn/post/6994747097899597860#heading-7">https://juejin.cn/post/6994747097899597860#heading-7</a></p>
<p>使用的话</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span> <span style="color:#a6e22e">setup</span><span style="color:#f92672">&gt;</span>
  <span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">useRouter</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;vue-router&#39;</span>
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">router</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useRouter</span>()

  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">goPage</span> <span style="color:#f92672">=</span> () =&gt; {
    <span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">push</span>({ <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;/page1&#39;</span>})
  }
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>

<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">template</span><span style="color:#f92672">&gt;</span>
  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">span</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;goPage&#34;</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">go</span> <span style="color:#a6e22e">page1</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/span&gt;</span>
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/template&gt;</span>
</code></pre></div><blockquote>
<p><code>useRoute</code>和<code>useRouter</code>，类似于<code>$route</code>和<code>$router</code></p>
</blockquote>
<h2 id="vuex4">vuex@4</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">createStore</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;vuex&#39;</span>

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">defaultState</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">count</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>
}

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">createStore</span>({
    <span style="color:#a6e22e">state</span>() {
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">defaultState</span>
    },
    <span style="color:#a6e22e">mutations</span><span style="color:#f92672">:</span> {
        <span style="color:#a6e22e">updataCount</span>(<span style="color:#a6e22e">state</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">defaultState</span>) {
            <span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">count</span><span style="color:#f92672">++</span>
        }
    },
    <span style="color:#a6e22e">actions</span><span style="color:#f92672">:</span> {},
    <span style="color:#a6e22e">getters</span><span style="color:#f92672">:</span> {}
})
</code></pre></div><p>然后我们在组件中使用的话，<code>useStore</code>相当于替代了<code>this.$store</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span> <span style="color:#a6e22e">setup</span><span style="color:#f92672">&gt;</span>
  <span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">useStore</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;vuex&#39;</span>

  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">store</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">useStore</span>()
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">count</span>)
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cheangeCount</span> <span style="color:#f92672">=</span> () =&gt; {
    <span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">commit</span>(<span style="color:#e6db74">&#34;updataCount&#34;</span>)
  }

<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>

<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">template</span><span style="color:#f92672">&gt;</span>
  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cheangeCount&#34;</span><span style="color:#f92672">&gt;</span>{{<span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">count</span>}}<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/template&gt;</span>
</code></pre></div><p>目前就暂时先记录这些，并不完整哈。
差不多先这样，还有很多都未曾使用或者看过，之后在开发过程中发现没写上去的之后在补了。</p>
    </div>
  </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/pastSeagull">Gaviota</a> 2016</p>
  </div>
</section>







<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>







<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>






