---
title: 项目环境配置笔记
date: 2021-1-15 22:36:29
tags:
---

首先这是学习笔记，这篇学习笔记是在学习的过程中的笔记，包括后面的那篇 webpack 笔记也是
当然不是完全 copy 过来，这个就是自己在学习过程中的笔记。
<!--more-->

[原博客的链接](https://github.com/vortesnail/blog/issues/14)
然后就是 [完成之后的 GitHub 链接](https://github.com/vortesnail/react-ts-quick-starter)
之前没看到所以自己在学习的时候出现了很多版本的问题。

# EditorConfig

用 EditorConfig 来配置代码格式，vscode 安装插件
在项目目录下创建`.editorconfig`文件，看一下官方文档，代码缩进风格，大小格式什么的都可以配置

```js
root = true

[*]
indent_style = space  // 缩进风格，tab or space
indent_size = 2       // 缩进大小
charset = utf-8       // 编码格式
trim_trailing_whitespace = true // 删除多余的空格
insert_final_newline = true     // 在尾部上插上一行
end_of_line = lf                // lf, cr, crlf。操作系统的的换行符不一样。

[*.md]
trim_trailing_whitespace = false // 关闭markdown的删除多余空格
```

# Prettier

主要是统一项目风格，一些框架的文档会说明框架是`opinionated` or `unopinionated`。

官网的介绍

> An opinionated code formatter  
> Supports many languages  
> Integrates with most editors  
> Has few options  
> 目录下创建`.prettierrc`文件，当然要使用 vocode 的插件，`prettierrc`和`editorconfig`有一些配置重合了，最好重合的配置都一样。

```js
{
  "trailingComma": "all",   // 最后一个属性末尾添加, {a: 1, b: 2} change {a: 1, b: 2,}
  "tabWidth": 2,            // 缩进大小
  "semi": false,            // 是否添加分号
  "singleQuote": true,      // 是否单引号
  "jsxSingleQuote": true,   // jsx的是否单引号
  "endOfLine": "lf",        // lf, cr, crlf。操作系统的的换行符不一样
  "printWidth": 120,        // 单行代码最长度，超过自动换行
  "bracketSpacing": true,   // 对象括号之家加空格{a: 1} chang { a: 1 }
  "arrowParens": "always"   // 箭头函数无论多少个参数都用括号包裹。 or 设置成 aviod
}
```

安装插件后，在根目录建`.vscode`，里面建`settings.json`，这个配置会优先于 vscode 的的全局`settings.json`。

```json
{
  // 指定哪些文件不参与搜索
  "search.exclude": {
    "**/node_modules": true,
    "dist": true,
    "yarn.lock": true
  },
  "editor.formatOnSave": true,
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[html]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[markdown]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[css]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[less]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[scss]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

# ESLint

`yarn add install eslint -D`
主要是检查代码质量问题`eslint --fix`还能修复代码写法
还有各种逼死强迫症的红色下划线，以前写 Vue 自定义指令，忘了啥报错了，不给运行项目，然后就通过 package.json 暂时关闭了这报错

ESLint 就通过 npm 安装就好了，`npx eslint --init`初始化的时候你需要啥就 Y。
安装完了就多出个文件`.eslintrc.js`,可以自行配置，然后 vscode 也有这个插件自动修复你的代码

- How would you like to use ESLint?
  > To check syntax, find problems, and enforce code style // 检查语法，检测问题，强制代码风格
- What type of modules does your project use?
  > JavaScript modules (import/export) // ES6 的模块导入导出
- Which framework does your project use?
  > React
- Does your project use TypeScript?
  > ts
- Which style guide do you want to follow?
  > Airbnb
- What format do you want your config file to be in?
  > js
- Would you like to install them now with npm?

多了个文件`.eslintrc.js`

```js
module.exports = {
  env: {
    browser: true,
    es2020: true,
    node: true,
  },
  extends: [
    "plugin:react/recommended",
    "airbnb",
    "airbnb/hooks", // React Hooks 的检查，自己添加
    "plugin:@typescript-eslint/recommended", // ts，但是要在下面添加rules 不然.ts 和 .tsx 文件中引入另一个文件模块会报错
  ],
  parser: "@typescript-eslint/parser",
  parserOptions: {
    ecmaFeatures: {
      jsx: true,
    },
    ecmaVersion: 11,
    sourceType: "module",
  },
  plugins: ["react", "@typescript-eslint"],
  // rules: {}, 添加的rules
  rules: {
    "import/extensions": [
      ERROR,
      "ignorePackages",
      {
        ts: "never",
        tsx: "never",
        json: "never",
        js: "never",
      },
    ],
  },
  // 添加配置文件
  settings: {
    "import/resolver": {
      node: {
        extensions: [".tsx", ".ts", ".js", ".json"],
      },
    },
  },
};
```

可以在安装两个插件`yarn add eslint-plugin-promise eslint-plugin-unicorn -D`,添加后的配置

```js
const OFF = 0;
const WARN = 1;
const ERROR = 2;

module.exports = {
  env: {
    browser: true,
    es2020: true,
    node: true,
  },
  extends: [
    "airbnb",
    "airbnb/hooks",
    "plugin:react/recommended",
    "plugin:unicorn/recommended",
    "plugin:promise/recommended",
    "plugin:@typescript-eslint/recommended",
  ],
  parser: "@typescript-eslint/parser",
  parserOptions: {
    ecmaFeatures: {
      jsx: true,
    },
    ecmaVersion: 11,
    sourceType: "module",
  },
  settings: {
    "import/resolver": {
      node: {
        extensions: [".tsx", ".ts", ".js", ".json"],
      },
    },
  },
  plugins: ["react", "unicorn", "promise", "@typescript-eslint"],
  rules: {
    "import/extensions": [
      ERROR,
      "ignorePackages",
      {
        ts: "never",
        tsx: "never",
        json: "never",
        js: "never",
      },
    ],
  },
};
```

因为安装了`@typescript-eslint/eslint-plugin`你必须要安装`typescrpt`。`yarn add typescript -D`。安装好了之后 ts 文件就有强迫症的下划线了

最后你在 vscode 在安装插件，在`.vscode`下的`settings.json`添加内容,保存的时候就会自动格式化

```json
{
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact"
  ],
  "typescript.tsdk": "./node_modules/typescript/lib", // 代替 vscode 的 ts 语法智能提示
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  }
}
```

# StyleLint

CSS 也有代码格式化 :( 安包`yarn add stylelint stylelint-config-standard -D`
创建`.stylelintrc.js`文件

```js
module.exports = {
  extends: ["stylelint-config-standard"],
  rules: {
    "comment-empty-line-before": null,
    "declaration-empty-line-before": null,
    "function-name-case": "lower",
    "no-descending-specificity": null,
    "no-invalid-double-slash-comments": null,
    "rule-empty-line-before": "always",
  },
  ignoreFiles: ["node_modules/**/*", "build/**/*"],
};
```

vscode 再次安装插件，在`.vscode`下的`settings.json`添加内容

```js
{
	// 使用 stylelint 自身的校验即可
  "css.validate": false,
  "less.validate": false,
  "scss.validate": false,

  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.fixAll.stylelint": true
  },
}
```

# 插件规则冲突

插件之间会有重合的规则，规则会有冲突，安装`yarn add eslint-config-prettier -D`来解决冲突

添加到`.eslintrc.js` 的 `extends`中

```js
{
  extends: [
    // other configs ...
   	'prettier',
    'prettier/@typescript-eslint',
    'prettier/react',
    'prettier/unicorn',
  ]
}
```

`stylelint`也是一样`yarn add stylelint-config-prettier -D`
在添加

```js
{
	extends: [
  	// other configs ...
    'stylelint-config-prettier'
  ]
}
```

# lint-staged

这个是对提交的代码格式化，`eslint` and `stylelint`规则检查。
对于提交到 git 缓冲区的那些，借用`husky`工具。安装`yarn add husky lint-staged -D`
package.json 中添加

```json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged"
    }
  },
  "lint-staged": {
    "*.{ts,tsx,js}": ["eslint --config .eslintrc.js"],
    "*.{css,less,scss}": ["stylelint --config .stylelintrc.js"],
    "*.{ts,tsx,js,json,html,yml,css,less,scss,md}": ["prettier --write"]
  }
}
```

# commitlint + changelog

对于 git commit 提交进行检查

好了开发之前的一些小知识，这里就作为一个小笔记记录一下。
